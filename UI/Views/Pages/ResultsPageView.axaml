<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:pages="clr-namespace:UI.ViewModels.Pages"
             xmlns:controls="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
             xmlns:lang="clr-namespace:UI.Lang"
             xmlns:questions="clr-namespace:UI.ViewModels.Questions"
             xmlns:converters="clr-namespace:UI.Utils.Converters"
             xmlns:mycontrols="clr-namespace:UI.Views.Controls"
             xmlns:input="clr-namespace:FluentAvalonia.UI.Input;assembly=FluentAvalonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:DataType="pages:ResultsPageViewModel"
             x:Class="UI.Views.Pages.ResultsPageView">
    
    <UserControl.Styles>
        <StyleInclude Source="/Styles/ButtonStyles.axaml"/>
    </UserControl.Styles>
    
    <DockPanel x:Name="PageContainer">
        <Grid DockPanel.Dock="Top" ColumnDefinitions="Auto, *">
            <Button Margin="20, 10, 0, 20"
                    HorizontalAlignment="Left"
                    Theme="{StaticResource TransparentButton}"
                    Command="{Binding ToQuestionPage}">
                <controls:SymbolIcon Symbol="Back" FontSize="20"/>
            </Button>
            <TextBlock Grid.Column="1"
                       Margin="20, 10, 0, 20"
                       HorizontalAlignment="Left"
                       Theme="{StaticResource SubtitleTextBlockStyle}"
                       Text="{Binding QuestionVM.Name, FallbackValue={x:Null}, Mode=OneWay}"/>
        </Grid>
        <StackPanel DockPanel.Dock="Top" Margin="20, 0, 20, 20">
            <TextBlock Margin="0, 0, 0, 20" Text="{Binding QuestionVM.Description, FallbackValue={x:Null}, Mode=OneWay}"/>
            <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                          ClipToBounds="True"
                          MaxHeight="200">
                <ItemsRepeater ItemsSource="{Binding CorrectParams}">
                    <ItemsRepeater.Styles>
                        <Style Selector="ItemsRepeater > Panel">
                            <Setter Property="Height" Value="30"/>
                        </Style>
                        <Style Selector="ItemsRepeater > Panel:nth-child(odd)">
                            <Setter Property="Background" Value="{DynamicResource SolidBackgroundFillColorTertiary}"/>
                        </Style>
                        <Style Selector="ItemsRepeater TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                        </Style>
                    </ItemsRepeater.Styles>
                    
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate>
                            <Panel>
                                <TextBlock HorizontalAlignment="Left" Margin="10, 0, 0, 0"
                                           Text="{Binding Key, Mode=OneWay}"/>
                                <TextBlock HorizontalAlignment="Right" Margin="0, 0, 20, 0"
                                           Text="{Binding Value, Converter={x:Static converters:ParamsConverters.AnyConverter}, Mode=OneWay}"/>
                            </Panel>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </ScrollViewer>
        </StackPanel>
        <Panel DockPanel.Dock="Bottom" 
               Margin="0, 20, 20, 20">
            <Button Name="AddFilesBtn"
                    Content="{x:Static lang:Lang.AddFilesBtnText}" 
                    HorizontalAlignment="Right" 
                    Command="{Binding AddFiles}"/>
        </Panel>
        <Panel DockPanel.Dock="Top"
               Margin="20, 0, 20, 10">
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Left">
                <TextBlock VerticalAlignment="Center"
                           Margin="0, 0, 20, 0"
                           FontSize="16"
                           Text="{x:Static lang:Lang.FilesLabel}"/>
                <CheckBox VerticalAlignment="Center"
                          IsThreeState="True"
                          IsChecked="{Binding CheckBoxState, Mode=OneWay}"
                          Command="{Binding ToggleSelection}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right">
                <Button Name="DeleteBtn" 
                        Classes="transparent-button"
                        Command="{Binding RemoveSelection}"
                        ToolTip.Tip="{x:Static lang:Lang.ToolTipRemoveSelection}">
                    <controls:SymbolIcon Symbol="Delete" FontSize="20"/>
                </Button>
                <Button Name="EvaluateBtn"
                        Classes="transparent-button"
                        Margin="5, 0, 0, 0"
                        Command="{Binding EvaluateButton}"
                        ToolTip.Tip="{x:Static lang:Lang.ToolTipEvaluateButton}">
                    <Grid ColumnDefinitions="Auto,Auto">
                        <TextBlock Text="{x:Static lang:Lang.EvaluateBtnText}"/>
                        <controls:SymbolIcon Grid.Column="1" Symbol="PlayFilled" FontSize="18" Foreground="{DynamicResource SystemFillColorSuccessBrush}"/>
                    </Grid>
                </Button>
            </StackPanel>
        </Panel>
        <ScrollViewer DockPanel.Dock="Top"
                      Margin="20, 0"
                      ClipToBounds="True">
            <ItemsRepeater Name="FileList"
                           ItemsSource="{Binding FilesResult}">
                <ItemsRepeater.Layout>
                    <StackLayout Spacing="5"/>
                </ItemsRepeater.Layout>
                
                <ItemsRepeater.Styles>
                    <Style Selector="Expander.success > StackPanel > controls|SymbolIcon">
                        <Setter Property="Foreground" Value="{DynamicResource SystemFillColorSuccessBrush}"/>
                    </Style>
                    <Style Selector="Expander.failure > StackPanel > controls|SymbolIcon">
                        <Setter Property="Foreground" Value="{DynamicResource SystemFillColorCriticalBrush}"/>
                    </Style>
                </ItemsRepeater.Styles>
                
                <ItemsRepeater.Resources>
                    <input:XamlUICommand x:Key="OnSelectedCommand"
                                         Command="{Binding RefreshCheckBoxState}"/>
                </ItemsRepeater.Resources>
                
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate DataType="{x:Type questions:FileResultViewModel}">
                        <mycontrols:FileResultControl/>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>
        </ScrollViewer>
    </DockPanel>
</UserControl>
